@baseUrl = http://localhost:3000
@tenant_token = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY5OGRjOTNhYmJmMmM2YWI2ODFiYzBjZSIsInJvbGUiOjAsImlhdCI6MTc3MDk4MDc2MywiZXhwIjoxNzcxNTg1NTYzfQ.W-k_X0sbUVPe8Tbhtq4WUNOqTznCbgVvWQVGeRl6jWo
@owner_token = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY5OGRhNjFmNDBlNDJlMWRiOWJhN2EyZCIsInJvbGUiOjEsImlhdCI6MTc3MTg1NDA5OCwiZXhwIjoxNzcyNDU4ODk4fQ.81cxa0IYFozBnHcF5W6xzzUFpfeH8xbyFwP8vXsjP_E

#######################################
### 2️⃣ LOGIN TENANT
#######################################

### Login tenant
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "chu-nha-01@gmail.com",
  "password": "0987654321"
}

### Logout
POST {{baseUrl}}/api/auth/logout
Authorization: Bearer {{tenant_token}}


#######################################
### 3️⃣ LOGIN OWNER (ĐÃ SET ROLE TRONG DB)
#######################################

### Login owner
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "admin@gmail.com",
  "password": "123456"
}

### Logout
POST {{baseUrl}}/api/auth/logout
Authorization: Bearer {{owner_token}}

#######################################
### 7️⃣ TEST GET USER BY ID
#######################################

### Owner get other user (SUCCESS)
GET {{baseUrl}}/api/users/6981a0b50a0f1d184ed05413
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response có thông tin user
###

### Tenant get their own user (SUCCESS)
GET {{baseUrl}}/api/users/698dc93abb72c6ab681bc0ce
Authorization: Bearer {{tenant_token}}

###
# EXPECT: 200 OK
# Tenant có thể xem user của họ
###

### Tenant get other user (FORBIDDEN)
GET {{baseUrl}}/api/users/6981a0b50a0f1d184ed05413
Authorization: Bearer {{tenant_token}}

###
# EXPECT: 403 Forbidden
# Response: {"message": "You can only view your own profile"}
###

### Get non-existent user (NOT FOUND)
GET {{baseUrl}}/api/users/507f1f77bcf86cd799439011
Authorization: Bearer {{owner_token}}

###
# EXPECT: 404 Not Found
# Response: {"message": "User not found"}
###

### Get user without auth (UNAUTHORIZED)
GET {{baseUrl}}/api/users/6981a0b50a0f1d184ed05413

###
# EXPECT: 401 Unauthorized
###

#######################################

### Get all users (SUCCESS - OWNER)
GET {{baseUrl}}/api/users
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có danh sách tất cả users (không có password)
###

### Search users by email
GET {{baseUrl}}/api/users?email=admin
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có users có email chứa "admin" (case insensitive)
###

### Search users by name
GET {{baseUrl}}/api/users?name=nguyen
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có users có tên chứa "nguyen" (case insensitive)
###

### Search users by phone
GET {{baseUrl}}/api/users?phone=0123
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có users có số điện thoại chứa "0123"
###

### Search users by multiple params (email + name)
GET {{baseUrl}}/api/users?email=gmail&name=van
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có users thỏa mãn cả email chứa "gmail" VÀ tên chứa "van"
###

### Get users with pagination (page 1, default limit 10)
GET {{baseUrl}}/api/users?page=1
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có max 10 users và pagination info
###

### Get users with custom limit (page 1, limit 5)
GET {{baseUrl}}/api/users?page=1&limit=5
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có max 5 users và pagination info
###

### Get users with search and pagination
GET {{baseUrl}}/api/users?email=gmail&page=1&limit=5
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có max 5 users có email chứa "gmail" và pagination info
###

### Get all users (TENANT - FORBIDDEN)
GET {{baseUrl}}/api/users
Authorization: Bearer {{tenant_token}}

###
# EXPECT: 403 Forbidden
###

### Get all users (WITHOUT AUTH - FAIL)
GET {{baseUrl}}/api/users

###
# EXPECT: 401 Unauthorized
###

#######################################
### 9️⃣ TEST BUILDING API
#######################################

### Create building (SUCCESS - OWNER)
POST {{baseUrl}}/api/buildings
Authorization: Bearer {{owner_token}}
Content-Type: application/json

{
  "name": "Toà nhà Green Park",
  "address": "789 Lê Văn Việt",
  "district": "Quận 9",
  "city": "TP.HCM",
  "totalFloors": 5,
  "totalRooms": 20,
  "yearBuilt": 2019,
  "description": "Toà nhà phù hợp cho sinh viên và nhân viên văn phòng",
  "utilities": ["Parking", "WiFi", "Laundry Room"]
}

###
# EXPECT: 201 Created
# Response sẽ có building data với ownerId = current user id
###

### Get building by ID (SUCCESS - OWNER)
GET {{baseUrl}}/api/buildings/698ed98d24f5a32a41e3fde4
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có building data
###

### Get all buildings (SUCCESS - OWNER)
GET {{baseUrl}}/api/buildings
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có tất cả buildings và pagination info
###

### Search buildings by name
GET {{baseUrl}}/api/buildings?name=chung
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có buildings có tên chứa "chung" (case insensitive)
###

### Search buildings by address
GET {{baseUrl}}/api/buildings?address=abc
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có buildings có địa chỉ chứa "abc" (case insensitive)
###

### Search buildings by district
GET {{baseUrl}}/api/buildings?district=quan
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có buildings có quận chứa "quan" (case insensitive)
###

### Search buildings by city
GET {{baseUrl}}/api/buildings?city=hcm
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có buildings có thành phố chứa "hcm" (case insensitive)
###

### Get buildings with pagination (page 1, default limit 10)
GET {{baseUrl}}/api/buildings?page=1
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có max 10 buildings và pagination info
###

### Get buildings with custom limit (page 1, limit 5)
GET {{baseUrl}}/api/buildings?page=1&limit=5
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có max 5 buildings và pagination info
###

### Get buildings with search and pagination
GET {{baseUrl}}/api/buildings?name=chung&page=1&limit=5
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có max 5 buildings có tên chứa "chung" và pagination info
###

### Update building (SUCCESS - OWNER)
PUT {{baseUrl}}/api/buildings/698ed98d24f5a32a41e3fde4
Authorization: Bearer {{owner_token}}
Content-Type: application/json

{
  "name": "Chung cư ABC Updated",
  "description": "Chung cư cao cấp - đã cập nhật"
}

###
# EXPECT: 200 OK
# Response sẽ có building data đã cập nhật
###

### Delete building (SUCCESS - OWNER)
DELETE {{baseUrl}}/api/buildings/698ed98d24f5a32a41e3fde4
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có building data đã xóa
###

### Create building (TENANT - FORBIDDEN)
POST {{baseUrl}}/api/buildings
Authorization: Bearer {{tenant_token}}
Content-Type: application/json

{
  "name": "Building by Tenant",
  "address": "456 Đường XYZ",
  "district": "Quận 2",
  "city": "TP.HCM",
  "totalFloors": 5,
  "totalRooms": 20,
  "yearBuilt": 2022
}

###
# EXPECT: 403 Forbidden
###

### Get building by ID (TENANT - FORBIDDEN)
GET {{baseUrl}}/api/buildings/698ed98d24f5a32a41e3fde4
Authorization: Bearer {{tenant_token}}

###
# EXPECT: 403 Forbidden
# TENANT không thể xem building details
###

#######################################
### 11️⃣ TEST ROOM API
#######################################

### Create room (SUCCESS - OWNER)
POST {{baseUrl}}/api/rooms
Authorization: Bearer {{owner_token}}
Content-Type: application/json

{
  "number": "101",
  "buildingId": "698ed98d24f5a32a41e3fde4",
  "floor": 1,
  "area": 50,
  "price": 5000000,
  "description": "Phòng 101"
}

###
# EXPECT: 201 Created
# Response sẽ có room data
###

### Get all rooms (SUCCESS - OWNER)
GET {{baseUrl}}/api/rooms
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có danh sách rooms và pagination info
###

### Get all rooms (TENANT - FORBIDDEN)
GET {{baseUrl}}/api/rooms
Authorization: Bearer {{tenant_token}}

###
# EXPECT: 403 Forbidden
# Chỉ chủ mới có thể xem danh sách phòng
###

### Search rooms by number
GET {{baseUrl}}/api/rooms?number=101
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có rooms có số phòng chứa "101" (case insensitive)
###

### Search rooms by building ID
GET {{baseUrl}}/api/rooms?buildingId=698ed98d24f5a32a41e3fde4
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có rooms thuộc tòa nhà có ID này
###

### Search rooms by floor
GET {{baseUrl}}/api/rooms?floor=1
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có rooms ở tầng 1
###

### Search rooms by status
GET {{baseUrl}}/api/rooms?status=available
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có rooms có trạng thái "available"
###

### Get rooms with pagination (page 1, default limit)
GET {{baseUrl}}/api/rooms?page=1
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có max 10 rooms và pagination info
###

### Get rooms with custom limit (page 1, limit 5)
GET {{baseUrl}}/api/rooms?page=1&limit=5
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có max 5 rooms và pagination info
###

### Get rooms without auth
GET {{baseUrl}}/api/rooms

###
# EXPECT: 401 Unauthorized
###

### Update room (SUCCESS - OWNER)
PUT {{baseUrl}}/api/rooms/{room_id}
Authorization: Bearer {{owner_token}}
Content-Type: application/json

{
  "price": 6000000,
  "description": "Phòng 101 - cập nhật"
}

###
# EXPECT: 200 OK
# Response sẽ có room data đã cập nhật
# Note: Replace {room_id} with the ID from a room in the building
###

### Update room (TENANT - FORBIDDEN)
PUT {{baseUrl}}/api/rooms/{room_id}
Authorization: Bearer {{tenant_token}}
Content-Type: application/json

{
  "price": 7000000
}

###
# EXPECT: 403 Forbidden
###

### Update room (NOT FOUND)
PUT {{baseUrl}}/api/rooms/507f1f77bcf86cd799439011
Authorization: Bearer {{owner_token}}
Content-Type: application/json

{
  "price": 8000000
}

###
# EXPECT: 404 Not Found
###

### Assign tenant (SUCCESS - OWNER)
POST {{baseUrl}}/api/rooms/69981d9e46c8af57f060929c/assign-tenant
Authorization: Bearer {{owner_token}}
Content-Type: application/json

{
  "userId": "698dc9dfeab8faf032a3314f"
}

###
# EXPECT: 200 OK
# Response sẽ có room data với currentTenant và status OCCUPIED
# Tenant record sẽ được tạo với moveInDate = ngày hiện tại, contractEndDate = null, emergencyContact = ""
###

### Assign tenant (TENANT - FORBIDDEN)
POST {{baseUrl}}/api/rooms/{room_id}/assign-tenant
Authorization: Bearer {{tenant_token}}
Content-Type: application/json

{
  "userId": "698dc93abb72c6ab681bc0ce"
}

###
# EXPECT: 403 Forbidden
###

### Assign tenant (NOT FOUND)
POST {{baseUrl}}/api/rooms/507f1f77bcf86cd799439011/assign-tenant
Authorization: Bearer {{owner_token}}
Content-Type: application/json

{
  "userId": "698dc93abb72c6ab681bc0ce"
}

###
# EXPECT: 404 Not Found
###

### Delete room (TENANT - FORBIDDEN)
DELETE {{baseUrl}}/api/rooms/{room_id}
Authorization: Bearer {{tenant_token}}

###
# EXPECT: 403 Forbidden
###

### Delete room (NOT FOUND)
DELETE {{baseUrl}}/api/rooms/507f1f77bcf86cd799439011
Authorization: Bearer {{owner_token}}

###
# EXPECT: 404 Not Found
###

### Delete room (SUCCESS - OWNER)
DELETE {{baseUrl}}/api/rooms/{room_id}
Authorization: Bearer {{owner_token}}

###
# EXPECT: 200 OK
# Response sẽ có room data đã xóa
###
